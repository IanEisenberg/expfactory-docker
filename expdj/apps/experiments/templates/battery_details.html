{% extends "base.html" %}
{% block head %}
{% endblock %}
{% block content %}
<h2>{{ battery.name }}</h2>

<div class="row" style="margin-top:0px">
    <div class="col-lg-12">
        <div>
            {% if edit_permission %}
                <a class='button' href='{% url 'edit_battery' battery.id %}'>Edit Battery</a>
                {% if has_results %}
                <a class='button' href='{% url 'export_battery' battery.id %}'>Export Results</a>
                {% endif %}
                {% if hits %}
                    <a class='button' target="_blank" href='{% url 'serve_hit' hits.0.id %}'>Preview</a>
                {% endif %}
            {% else %}
                <div class="alert alert-info" role="alert">You do not have permission to edit this battery, but you can
                <a href='{% url 'serve_hit' hits.0.id %}' target="_blank">preview</a> it.</div>
            {% endif %}

            <div class="float_right">
                {% if edit_permission %}
                    {% if battery.experiments.all %}
                        <a class='button' href='{% url 'multiple_new_hit' battery.id %}'> Batch HITs</a>
                        <a class='button' href='{% url 'new_hit' battery.id %}'> New HIT</a>
                    {% endif %}
                {% endif %}
                {% if delete_permission %}
                <a class='button' href='{% url 'delete_battery' battery.id %}' id="delete_battery"> Delete Battery</a>
                {% endif %}
            </div>
      </div>
</div>


    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-body">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#details" data-toggle="tab">Details</a></li>
                <li><a href="#experiments" data-toggle="tab">Experiments</a></li>
                <li><a href="#hits" title="A HIT is a deployment of experiments to Amazon Mechanical Turk" data-toggle="tab">HITS</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade in active" id="details">
                    <h4>Battery Details</h4>

    <table class="table table-condensed table-striped table-hover" id="details-table">
      <thead>
        <tr>
          <th>Field</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
          <tr><td>Battery Name</td><td>{{ battery.name }}</td></tr>
          <tr><td>Experiments</td><td>{{ battery.experiments.count }}</td></tr>
          <tr><td>Max Time</td><td>{{ battery.maximum_time }}</td></tr>
          <tr><td>Max Experiments</td><td>{{ battery.number_of_experiments }}</td></tr>
          <tr><td>Active</td><td>{{ battery.active }}</td></tr>
      </tbody>
    </table>

    </div>
        <!-- Experiments Pane -->
        <div class="tab-pane fade" id="experiments">
            <h4>Experiments</h4>
	    {% if battery.experiments.all %}
            <table class="hover" cellspacing="0" width="100%" id="experiments_table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Cognitive Atlas Task</th>
               </tr>
           </thead>
           <tbody>
           {% for experiment in battery.experiments.all %}
               <tr>
                   <td><a href="{% url 'experiment_details' battery.id experiment.id %}">{{ experiment.template.name }}</a></td>
                   <td><a href="http://www.cognitiveatlas.org/term/id/{{ experiment.cognitive_atlas_task.cog_atlas_id }}" target="_blank">{{ experiment.template.cognitive_atlas_task }}</a></td>
                   <td>
                      {% if edit_permission %}
                      <a class="btn btn-default" title="export experiment results" href="{% url 'export_experiment' experiment.id %}"><i class="fa fa-download"></i></a>
                      {% endif %}
                      {% if delete_permission %}
                      <a class="btn btn-danger" title="remove experiment from battery" href="{% url 'remove_experiment' battery.id experiment.id %}" id="delete_experiment"><i class="fa fa-trash"></i></a>
                      {% endif %}
                      <a class="btn btn-default" target="_blank" title="preview" href="{% url 'preview_experiment' experiment.template.tag %}" id="preview_experiment"><i class="fa fa-eye"></i></a>
                   </td>
               </tr>
          {% endfor %}
          </tbody>
          </table>
          {% if edit_permission %}
          <a style="padding-top:20px" class='button btn-primary' href='{% url 'add_experiment' battery.id %}'>Add or Edit Experiments</a>
          {% endif %}
         {% else %}
             {% if edit_permission %}
             <a class='button btn-primary' href='{% url 'add_experiment' battery.id %}'>Add Experiments to Battery</a>
             {% endif %}
         {% endif %}
        </div>

        <!-- Completion/Stats Pane -->
        <div class="tab-pane fade" id="hits">
            <h4>Amazon Mechanical Turk HITS</h4>
                {% if hits %}
                {% for hit in hits %}
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading{{ hit.id }}" style="height:50px">
                            <h4 class="panel-title">
                                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#hitdetails{{ hit.id }}" aria-expanded="true" aria-controls="collection">
                                    <div class="row">
                                        <div class="col-md-10">
                                            {{ hit.title }}
                                        </div>
                                    </div>
                                </a>
                            </h4>
                        </div>
                        <div id="hitdetails{{ hit.id }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{ hit.id }}">
                               <div class="panel-body">
                                 <table class="table table-condensed table-striped table-hover" id="hits_table">
                                     <thead>
                                         <th>title</th>
                                         <th>keywords</th>
                                         <th>description</th>
                                         <th>reward</th>
                                     </thead>
                                     <tbody>
                                         <tr><td>{{ hit.title }}</td>
                                         <td>{{ hit.keywords }}</td>
                                         <td>{{ hit.description }}</td>
                                         <td>{{ hit.reward }}</td></tr>
                                     </tbody>
                                </table>
                               </div>
                               {% if edit_permission %}
                               <a class='button' href='{% url 'expire_hit' hit.id %}' id="expire_hit"> Expire Hit</a>
                               <a class='button btn-danger' href='{% url 'delete_hit' hit.id %}' id="delete_hit"> Delete Hit</a>
                               <i data-toggle="tooltip" title="EXPIRING a HIT means it will no longer appear on the Mechanical Turk web site, and no new Workers will be allowed to accept the HIT. The record will remain here. DELETING a hit means expiring it and removing the link to it from the Experiment Factory." style="padding-left:10px;padding-top:5px" class="fa fa-2x fa-question-circle"></i>
                               {% endif %}
                        </div><!--end tab thing-->
                      </div><!-- panel-->
                   </div><!--group-->
                   {% endfor %}
                   {% else %}
                       {% if battery.experiments.all %}
                       <a class='button' href='{% url 'multiple_new_hit' battery.id %}'> Batch HITs</a>
                       <a class='button' href='{% url 'new_hit' battery.id %}'> New HIT</a>
                       {% else %}
                       <div class="alert alert-info" role="alert">You must <a href='{% url 'add_experiment' battery.id %}'>add experiments</a> to your battery before sending HITs.</div>
                       {% endif %}
                   {% endif %}
                </div>
            </div>
        </div>
   </div>
</div>
{% endblock %}
{% block scripts %}
<script>
$(document).ready(function() {
    $('#battery_table').dataTable({
      responsive: true
    });
    $('#experiments_table').dataTable({
      responsive: true
    });
    $('#hits_table').dataTable({
      responsive: true
    });
    $('#delete_experiment').click(function(e) {
      return confirm("This will remove the experiment from the battery, and not delete it from the application. Are you sure you want to do this?");
    });
    $('#delete_hit').click(function(e) {
      return confirm("Are you sure you want to delete this hit? This operation cannot be undone!");
    });
} );
</script>

</script>
{% endblock %}
